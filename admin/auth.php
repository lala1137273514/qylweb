<?php
/* 作者QQ：2769544753，未经允许禁止倒卖！ */
 goto ciVz2RVNZl; iX0_FvJJ57: function csrf_token() { if (!empty($_SESSION["\x63\163\x72\x66\x5f\164\x6f\153\x65\156"])) { goto TpSgIqJDq4; } $_SESSION["\143\x73\x72\x66\137\x74\157\x6b\145\x6e"] = bin2hex(random_bytes(32)); TpSgIqJDq4: return $_SESSION["\143\163\x72\146\x5f\x74\157\x6b\x65\156"]; } goto Bzeym_P4wu; ciVz2RVNZl: require_once __DIR__ . "\x2f\x63\x6f\x6e\146\x69\x67\x2e\160\150\x70"; session_name(SESSION_NAME); $isHttps = !empty($_SERVER["\110\x54\124\120\123"]) && $_SERVER["\x48\x54\124\120\123"] !== "\x6f\146\x66" || !empty($_SERVER["\x48\x54\124\120\x5f\x58\137\x46\117\122\127\x41\x52\x44\x45\104\x5f\x50\x52\117\124\117"]) && $_SERVER["\x48\124\124\x50\x5f\x58\137\x46\117\x52\127\x41\122\x44\x45\104\x5f\x50\x52\117\124\117"] === "\x68\164\x74\160\163" || ($_SERVER["\x53\105\122\126\x45\122\137\120\117\122\x54"] ?? 80) == 443; session_set_cookie_params(["\154\x69\146\x65\164\151\155\x65" => SESSION_LIFETIME, "\160\141\164\150" => "\x2f", "\x64\x6f\155\141\151\x6e" => '', "\163\145\143\165\162\145" => $isHttps, "\x68\164\x74\x70\x6f\156\154\171" => true, "\163\x61\155\145\163\x69\164\x65" => "\114\141\170"]); session_start(); goto K5CEOyjXhU; K5CEOyjXhU: function is_logged_in() { return !empty($_SESSION["\x61\144\x6d\151\156\x5f\x6c\x6f\x67\x67\x65\144\137\151\156"]) && $_SESSION["\x61\x64\155\x69\x6e\137\154\x6f\147\x67\x65\144\137\x69\156"] === true; } function require_login() { if (is_logged_in()) { goto SEy_aI4mHS; } header("\x4c\x6f\x63\x61\164\151\157\x6e\72\x20\151\x6e\144\x65\170\56\x70\150\160"); exit; SEy_aI4mHS: } function login($username, $password) { goto l0QZiUYGjk; WXsgKTBAU9: $_SESSION["\x61\x64\x6d\151\156\137\154\157\x67\x67\145\x64\137\151\156"] = true; $_SESSION["\x61\144\x6d\x69\x6e\x5f\165\x73\x65\x72"] = $username; session_regenerate_id(true); return true; La0liOrhQj: goto Ii_mshT3HB; Ii_mshT3HB: return false; goto HE1aQJ53yt; l0QZiUYGjk: $admin = read_json(ADMIN_FILE); if ($admin) { goto vuMDbEI0Jx; } return false; vuMDbEI0Jx: if (!($username === $admin["\165\x73\x65\162\156\141\x6d\x65"] && password_verify($password, $admin["\x70\141\x73\163\167\157\162\x64\x5f\150\141\163\150"]))) { goto La0liOrhQj; } goto WXsgKTBAU9; HE1aQJ53yt: } function logout() { $_SESSION = []; if (!ini_get("\x73\x65\163\x73\151\157\156\x2e\x75\163\145\x5f\143\x6f\157\x6b\151\145\163")) { goto yXnbNvQQXe; } $p = session_get_cookie_params(); setcookie(session_name(), '', time() - 42000, $p["\x70\141\x74\x68"], $p["\x64\x6f\x6d\141\x69\x6e"], $p["\163\x65\143\165\x72\x65"], $p["\150\164\164\160\157\156\x6c\x79"]); yXnbNvQQXe: session_destroy(); } function change_password($old_pass, $new_pass) { goto ZQffYNZN0N; ItmwgxvGkb: $admin["\160\141\163\x73\167\157\162\144\137\x68\x61\163\150"] = password_hash($new_pass, PASSWORD_DEFAULT); write_json(ADMIN_FILE, $admin); return ["\x73\x75\x63\x63\x65\x73\x73" => true, "\155\145\163\x73\x61\147\145" => "\345\257\206\xe7\xa0\x81\xe4\277\xae\xe6\224\271\xe6\x88\220\345\x8a\237"]; goto H5Y6RiWWmh; rI5wXej2na: return ["\163\165\x63\x63\145\163\163" => false, "\x6d\145\163\163\x61\147\x65" => "\345\216\x9f\345\257\206\xe7\240\201\351\x94\231\xe8\257\257"]; AKW9WrQRdY: if (!(strlen($new_pass) < 8)) { goto B0n8zvR3aI; } return ["\163\165\143\143\x65\163\x73" => false, "\155\145\x73\x73\141\x67\x65" => "\xe6\226\xb0\xe5\xaf\206\347\xa0\201\xe4\xb8\x8d\350\x83\275\345\260\221\xe4\xba\x8e\40\x38\x20\344\xbd\215"]; B0n8zvR3aI: goto ItmwgxvGkb; ZQffYNZN0N: $admin = read_json(ADMIN_FILE); if ($admin) { goto qV0ho2vkM3; } return ["\x73\165\x63\143\145\x73\163" => false, "\x6d\145\163\163\x61\x67\145" => "\351\205\215\xe7\275\256\346\x96\207\344\273\266\350\257\xbb\345\x8f\x96\xe5\244\xb1\350\xb4\245"]; qV0ho2vkM3: if (password_verify($old_pass, $admin["\x70\141\163\163\x77\x6f\x72\x64\137\x68\x61\x73\x68"])) { goto AKW9WrQRdY; } goto rI5wXej2na; H5Y6RiWWmh: } goto iX0_FvJJ57; Bzeym_P4wu: function verify_csrf($token) { if (!(empty($_SESSION["\143\163\162\x66\137\x74\157\153\x65\156"]) || empty($token))) { goto bvxmd7DTJb; } return false; bvxmd7DTJb: return hash_equals($_SESSION["\x63\x73\x72\146\137\x74\x6f\x6b\x65\156"], $token); }